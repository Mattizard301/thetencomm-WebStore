<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE TEN. | Modern Faith</title>
    
    <!-- Modern Google Fonts + Cinzel (Added for the Law page) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Montserrat:wght@400;500;600;800;900&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Cinzel:wght@400;600;800&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Confetti for Gamification -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Montserrat', 'sans-serif'],
                        serif: ['Cormorant Garamond', 'serif'],
                        cinzel: ['Cinzel', 'serif'],
                        cormorant: ['Cormorant Garamond', 'serif'], // Added for Old Code compatibility
                    },
                    colors: {
                        brand: {
                            dark: '#1C1917',    // Warm Charcoal
                            primary: '#D97706', // Warm Amber/Gold
                            secondary: '#78716C', // Stone
                            surface: '#FDFBF7', // Warm Paper/Cream
                            soft: '#E7E5E4'      // Light Stone
                        }
                    },
                    keyframes: {
                        'float': {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        'pulse-glow': {
                            '0%, 100%': { boxShadow: '0 0 20px rgba(217, 119, 6, 0.3)' }, 
                            '50%': { boxShadow: '0 0 40px rgba(217, 119, 6, 0.6)' },
                        },
                        'sound-wave': {
                            '0%, 100%': { height: '4px', opacity: '0.5' },
                            '50%': { height: '40px', opacity: '1' },
                        },
                        'slide-in-right': {
                            '0%': { transform: 'translateX(100%)', opacity: '0' },
                            '100%': { transform: 'translateX(0)', opacity: '1' },
                        },
                        'slide-up': {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        'fade-in-up': {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        'scale-in': {
                            '0%': { opacity: '0', transform: 'scale(0.95)' },
                            '100%': { opacity: '1', transform: 'scale(1)' },
                        },
                        'bounce-subtle': {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' },
                        }
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-glow': 'pulse-glow 3s infinite',
                        'sound-wave': 'sound-wave 1s ease-in-out infinite',
                        'fade-in': 'fade-in 0.5s ease-out',
                        'fade-in-up': 'fade-in-up 0.8s ease-out forwards',
                        'slide-up': 'slide-up 0.5s ease-out forwards',
                        'scale-in': 'scale-in 0.3s ease-out forwards',
                        'slide-in-right': 'slide-in-right 0.5s cubic-bezier(0.16, 1, 0.3, 1)',
                        'bounce-subtle': 'bounce-subtle 2s infinite',
                    }
                }
            }
        }
    </script>

    <!-- Import Map for React & Firebase -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.292.0",
            "firebase/app": "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js",
            "firebase/auth": "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js",
            "firebase/firestore": "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"
        }
    }
    </script>

    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #FDFBF7; }
        ::-webkit-scrollbar-thumb { background: #D6D3D1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #A8A29E; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-fade-in { animation: fade-in 0.5s ease-out; }
        
        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
    </style>
</head>
<body class="bg-brand-surface text-brand-dark font-sans selection:bg-brand-primary selection:text-white antialiased">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            ShoppingBag, BookOpen, Menu, X, ArrowRight, Mic, Volume2, VolumeX, 
            Gift, Sparkles, Feather, Flame, Shield, Download, Cross, Heart, 
            Mail, Printer, ScrollText, Calendar, Clock, Headphones, Zap, 
            Play, MessageCircle, Star, ToggleLeft, ToggleRight, Eye, EyeOff, Search, CheckCircle,
            Sun, CloudRain, Wind, Mountain, Trophy, Target, RefreshCw, Smile, Frown, Meh, CloudLightning
        } from 'lucide-react';

        // --- FIREBASE CONFIG ---
        import { initializeApp } from "firebase/app";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "firebase/auth";
        import { getFirestore, collection, addDoc, serverTimestamp } from "firebase/firestore";

        // Placeholder config - Add your details to enable Firebase features
        const firebaseConfig = {}; 
        let auth, db;
        if (firebaseConfig.apiKey) {
            const app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
        }

        // Add your Gemini API Key here to enable the AI Scholar features
        const GEMINI_API_KEY = ""; 

        // --- DATA LAYER ---
        const BLOG_POSTS = [
            {
                id: 1,
                title: "Silence in a Noisy World",
                date: "Oct 12",
                readTime: "4m",
                category: "Discipline",
                excerpt: "In an age of constant notification, silence is an act of spiritual rebellion.",
                content: "The modern world abhors a vacuum. Every moment of our day is filled with pings, rings, and buzzes. We are terrified of being alone with our thoughts. But the Desert Fathers knew something we have forgotten: it is only in silence that we can truly hear. \n\nTo practice silence is to reclaim your agency. It is to say 'no' to the demands of the immediate so you can say 'yes' to the eternal. Start small. Five minutes. No phone. No music. Just you and the Creator."
            },
            {
                id: 2,
                title: "Why the Law Still Matters",
                date: "Oct 08",
                readTime: "6m",
                category: "Theology",
                excerpt: "Is the Old Testament obsolete? Why do we study commandments written on stone?",
                content: "A common misconception is that the New Testament abolishes the Old. But Jesus Himself said He came not to abolish, but to fulfill. The Law acts as a mirror. It shows us our imperfections not to shame us, but to drive us toward Grace. \n\nWithout the Law, Grace has no texture. Without the standard, we cannot appreciate the sacrifice that met it."
            },
            {
                id: 3,
                title: "The Idol of Comfort",
                date: "Sep 29",
                readTime: "5m",
                category: "Culture",
                excerpt: "The First Commandment warns against other gods. Today, our golden calf is comfort.",
                content: "We rarely bow down to statues of gold today. Our idolatry is more subtle. We worship convenience. We sacrifice our integrity on the altar of 'easier'. \n\nThe call to follow is a call to die to self. It is inherently uncomfortable. If your faith fits perfectly into your schedule and never challenges your preferences, you may be worshipping a god of your own making."
            }
        ];

        const DAILY_INSPIRATION = {
            verse: { text: "Do not conform to the pattern of this world, but be transformed by the renewing of your mind.", reference: "Romans 12:2" },
            quote: { text: "God loves each of us as if there were only one of us.", author: "Saint Augustine" },
            action: { title: "Digital Fast", task: "Put your phone in another room for 30 minutes and pray." }
        };

        const QUESTS = [
            { id: 1, title: "The Encourager", task: "Send a text to a friend you haven't spoken to in a month telling them you appreciate them." },
            { id: 2, title: "The Silent Hour", task: "Spend 15 minutes in absolute silence without your phone." },
            { id: 3, title: "The Generous Hand", task: "Buy a coffee or meal for a stranger or coworker today." },
            { id: 4, title: "The Grateful Heart", task: "Write down 3 specific things you are thankful for right now." },
            { id: 5, title: "The Peacemaker", task: "Pray for someone you currently have conflict with." }
        ];

        const RESOURCES = [
            { id: 1, name: "Peace Bible", price: 24.99, category: "Study Tools", icon: BookOpen, color: "bg-blue-100", description: "Pocket-sized peace. Highlighted verses for anxiety.", keywords: ["anxiety", "worry", "fear", "peace"] },
            { id: 2, name: "Heart Reset Guide", price: 0, category: "Free Guides", icon: Download, color: "bg-purple-100", description: "10-day digital detox devotional PDF.", keywords: ["detox", "guide", "free", "reset"] },
            { id: 3, name: "Evangelist Cap", price: 29.99, category: "Wearable Faith", icon: Shield, color: "bg-orange-100", description: "Vintage wash cap to spark conversations.", keywords: ["hat", "cap", "clothing", "wear"] },
            { id: 4, name: "Covenant Band", price: 12.99, category: "Wearable Faith", icon: Heart, color: "bg-red-100", description: "Silicone reminder of integrity.", keywords: ["band", "wrist", "reminder"] },
            { id: 5, name: "Olive Cross", price: 18.99, category: "Study Tools", icon: Cross, color: "bg-green-100", description: "Hand-carved comfort from the Holy Land.", keywords: ["cross", "wood", "holding"] }
        ];

        const COMMANDMENTS = [
            { id: 1, text: "Thou shalt have no other gods before me.", meaning: "Exclusive Devotion", deepDive: "Prioritize the Source of Life above career, money, or ego.", scriptures: ["Ex 20:3"] },
            { id: 2, text: "Thou shalt not make unto thee any graven image.", meaning: "Worship the Creator", deepDive: "Do not create false idols or shrink God to fit your box.", scriptures: ["Ex 20:4"] },
            { id: 3, text: "Thou shalt not take the name of the Lord in vain.", meaning: "Carry Honor", deepDive: "Represent the King well. Do not carry His name loosely.", scriptures: ["Ex 20:7"] },
            { id: 4, text: "Remember the sabbath day.", meaning: "Rest & Trust", deepDive: "You are not a machine. Trust God's provision enough to stop.", scriptures: ["Ex 20:8"] },
            { id: 5, text: "Honor thy father and thy mother.", meaning: "Foundations", deepDive: "Respect your roots and the office of parenthood.", scriptures: ["Ex 20:12"] },
            { id: 6, text: "Thou shalt not kill.", meaning: "Sanctity of Life", deepDive: "Anger is the seed of murder. Protect and nurture life.", scriptures: ["Ex 20:13"] },
            { id: 7, text: "Thou shalt not commit adultery.", meaning: "Faithfulness", deepDive: "Guard your covenant and your eyes.", scriptures: ["Ex 20:14"] },
            { id: 8, text: "Thou shalt not steal.", meaning: "Integrity", deepDive: "Trust that God's way of provision is better than shortcuts.", scriptures: ["Ex 20:15"] },
            { id: 9, text: "Thou shalt not bear false witness.", meaning: "Truth", deepDive: "Let your Yes be Yes. Protect your neighbor's name.", scriptures: ["Ex 20:16"] },
            { id: 10, text: "Thou shalt not covet.", meaning: "Contentment", deepDive: "The war for the heart. Find joy in your own portion.", scriptures: ["Ex 20:17"] },
        ];

        const SYSTEM_PROMPT = `
        You are a devoted theologian and teacher in "The Study" of The Ten Commandments website.
        Your primary goal is EDUCATION and SPIRITUAL GROWTH. 
        You are NOT a salesperson. You are a mentor.
        Answer questions with biblical depth, historical context, and grace.
        Only if a user specifically mentions a need that matches one of our ministry tools (like anxiety, prayer focus, or evangelism), you may gently mention we have a resource for that, but do not push it.
        Focus on the heart, the history of Israel, and the fulfillment of the law in Jesus.
        Keep your responses conversational and suitable for being read aloud.
        `;

        // --- SUB-COMPONENTS ---

        // Notification System
        function ToastContainer({ toasts, removeToast }) {
            return (
                <div className="fixed bottom-6 right-6 z-[100] flex flex-col gap-4 pointer-events-none">
                    {toasts.map(toast => (
                        <div key={toast.id} className="bg-white text-brand-dark px-6 py-4 rounded-full shadow-2xl flex items-center gap-4 animate-slide-in-right pointer-events-auto min-w-[300px] border border-stone-100">
                            <CheckCircle className="w-6 h-6 text-green-500" />
                            <div>
                                <h4 className="font-bold text-sm">{toast.title}</h4>
                                <p className="text-xs text-stone-500">{toast.message}</p>
                            </div>
                            <button onClick={() => removeToast(toast.id)} className="ml-auto text-stone-300 hover:text-brand-dark"><X className="w-4 h-4" /></button>
                        </div>
                    ))}
                </div>
            );
        }

        function Footer({ view }) {
            return (
                <footer className={`no-print bg-[#1c1917] text-white py-20 border-t border-stone-800 ${view === 'ai' ? 'mt-0' : 'mt-32'}`}>
                    <div className="max-w-7xl mx-auto px-6 grid grid-cols-1 md:grid-cols-2 gap-16">
                        <div>
                            <div className="flex items-center gap-2 mb-6">
                                <h3 className="font-display font-black text-3xl tracking-tighter">THE TEN.</h3>
                            </div>
                            <p className="text-stone-400 mb-8 max-w-sm leading-relaxed text-lg font-light">
                                Lighting the way for modern disciples. We bridge ancient wisdom with future-proof faith.
                            </p>
                            <div className="flex gap-4">
                                <span className="bg-stone-800 px-4 py-2 rounded-full text-xs font-bold text-stone-300 tracking-wider uppercase">Â© 2025</span>
                                <span className="bg-stone-800 px-4 py-2 rounded-full text-xs font-bold text-stone-300 tracking-wider uppercase">Soli Deo Gloria</span>
                            </div>
                        </div>
                        <div className="bg-stone-800/30 p-10 rounded-3xl border border-stone-800/50 backdrop-blur-sm">
                            <h4 className="font-bold mb-3 text-white text-xl">Join the Movement</h4>
                            <p className="text-sm text-stone-400 mb-6">Daily sparks of wisdom in your inbox. No spam, just substance.</p>
                            <div className="flex gap-3">
                                <input type="email" placeholder="you@email.com" className="bg-stone-900/50 border border-stone-700 rounded-xl px-5 py-4 flex-1 text-sm text-white focus:outline-none focus:border-brand-primary placeholder:text-stone-600" />
                                <button className="bg-white text-brand-dark font-bold px-8 rounded-xl hover:bg-brand-primary hover:text-white transition-all duration-300">Join</button>
                            </div>
                        </div>
                    </div>
                </footer>
            );
        }

        // --- VIEW COMPONENTS ---

        function ModernHomeView({ setView, incrementStreak, streak }) {
            const [todaysQuest, setTodaysQuest] = useState(QUESTS[0]);
            const [questCompleted, setQuestCompleted] = useState(false);
            
            // New Habits State
            const [habits, setHabits] = useState([
                { id: 'word', label: 'Scripture', icon: BookOpen, completed: false },
                { id: 'prayer', label: 'Prayer', icon: Heart, completed: false },
                { id: 'silence', label: 'Silence', icon: VolumeX, completed: false },
                { id: 'charity', label: 'Charity', icon: Gift, completed: false }
            ]);

            useEffect(() => {
                // Randomize quest on load if not completed
                const random = QUESTS[Math.floor(Math.random() * QUESTS.length)];
                setTodaysQuest(random);
                
                // Load habits from local storage
                const savedHabits = localStorage.getItem('lumen_habits_today');
                const lastDate = localStorage.getItem('lumen_habits_date');
                const today = new Date().toDateString();

                if (savedHabits && lastDate === today) {
                    setHabits(JSON.parse(savedHabits));
                } else {
                    localStorage.setItem('lumen_habits_date', today);
                }
            }, []);

            const handleCompleteQuest = () => {
                if (questCompleted) return;
                setQuestCompleted(true);
                incrementStreak();
                
                // Trigger Confetti - Gold and White for holiness
                confetti({
                    particleCount: 200,
                    spread: 100,
                    origin: { y: 0.6 },
                    colors: ['#FFD700', '#FFFFFF', '#FDFBF7'],
                    disableForReducedMotion: true
                });
            };

            const toggleHabit = (id) => {
                setHabits(prev => {
                    const newHabits = prev.map(h => {
                        if (h.id === id) {
                            if (!h.completed) {
                                confetti({
                                    particleCount: 40,
                                    spread: 50,
                                    origin: { y: 0.8 },
                                    colors: ['#FFD700'],
                                    ticks: 200
                                });
                            }
                            return { ...h, completed: !h.completed };
                        }
                        return h;
                    });
                    localStorage.setItem('lumen_habits_today', JSON.stringify(newHabits));
                    return newHabits;
                });
            };

            return (
                <div className="animate-fade-in pb-8 bg-[#FDFBF7]">
                    
                    {/* HOLY HERO SECTION WITH RICHER BACKGROUND */}
                    <div className="relative w-full overflow-hidden">
                        
                        {/* 1. Base Gradient: Warm Parchment/Gold fading to white */}
                        <div className="absolute inset-0 bg-gradient-to-b from-[#F3E5D0] via-[#FDFBF7] to-[#FDFBF7] z-0"></div>
                        
                        {/* 2. Texture Overlay: Adds a non-digital, tactile feel */}
                        <div className="absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/noise-lines.png')] z-0 mix-blend-multiply pointer-events-none"></div>
                        
                        {/* 3. Divine Light Burst: A massive glow behind the text */}
                        <div className="absolute top-[-20%] left-1/2 -translate-x-1/2 w-[120%] h-[1000px] bg-[radial-gradient(circle_at_center,_rgba(251,191,36,0.15),_transparent_60%)] blur-3xl z-0 pointer-events-none"></div>

                        {/* Content Container - REDUCED PADDING HERE */}
                        <div className="relative z-10 flex flex-col items-center pt-8 md:pt-12 pb-10 px-6">
                            
                            {/* Title Block - REDUCED MARGIN */}
                            <div className="text-center mb-8 max-w-4xl relative">
                                <h1 className="font-serif text-5xl md:text-8xl text-[#2C1810] leading-none mb-4 tracking-tight drop-shadow-sm">
                                    The Good <span className="italic text-amber-700/90">Shepherd</span>
                                </h1>
                                <p className="font-serif text-lg md:text-xl text-stone-700 italic max-w-2xl mx-auto font-medium">
                                    "He makes me lie down in green pastures. He leads me beside still waters."
                                </p>
                            </div>

                            {/* The Arch Image */}
                            <div className="relative w-full max-w-6xl aspect-[4/5] md:aspect-[21/9] shadow-2xl z-10 mx-auto">
                                {/* CSS Mask for Arch Shape */}
                                <div className="absolute inset-0 overflow-hidden rounded-t-[1000px] rounded-b-[40px] border-8 border-white bg-white shadow-xl">
                                    <img 
                                        src="https://images.unsplash.com/photo-1484557985045-edf25e08da73?q=80&w=2073&auto=format&fit=crop" 
                                        className="w-full h-full object-cover hover:scale-105 transition-transform duration-[20s]" 
                                        alt="The Good Shepherd" 
                                    />
                                    {/* Vignette Overlay */}
                                    <div className="absolute inset-0 bg-gradient-to-t from-[#2C1810]/40 to-transparent"></div>
                                    
                                    <div className="absolute bottom-8 left-0 right-0 text-center">
                                        <button onClick={() => setView('law')} className="bg-white/90 backdrop-blur-sm text-[#2C1810] font-serif font-bold italic text-lg px-10 py-3 rounded-full hover:bg-white hover:scale-105 transition-all shadow-lg border border-amber-100/50">
                                            Begin the Journey
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* THE DAILY BREAD: Journal Layout - WIDENED TO MAX-W-7XL */}
                    <div className="w-full max-w-7xl mx-auto px-6 mb-12 relative z-10">
                        <div className="bg-white p-6 md:p-10 rounded-[2rem] shadow-xl border border-stone-100 relative overflow-hidden">
                            {/* Paper Texture Effect */}
                            <div className="absolute inset-0 bg-[#FDFBF7] opacity-50 pointer-events-none"></div>
                            <div className="absolute top-0 left-1/2 -translate-x-1/2 w-px h-full bg-gradient-to-b from-transparent via-stone-200 to-transparent hidden md:block"></div>

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-10 relative z-10">
                                
                                {/* Left Side: Daily Quest */}
                                <div className="flex flex-col items-center text-center">
                                    <div className="mb-4">
                                        <h3 className="font-serif text-2xl text-[#2C1810] italic mb-1">Daily Act of Grace</h3>
                                        <div className="h-1 w-12 bg-amber-300 mx-auto rounded-full"></div>
                                    </div>
                                    
                                    <div className="flex-1 flex flex-col justify-center mb-6">
                                        <p className="font-serif text-xl text-stone-600 leading-relaxed">
                                            "{todaysQuest.task}"
                                        </p>
                                    </div>

                                    <button 
                                        onClick={handleCompleteQuest}
                                        disabled={questCompleted}
                                        className={`w-full py-3 border-2 rounded-xl font-serif text-lg transition-all ${questCompleted ? 'border-green-500 text-green-700 bg-green-50' : 'border-[#2C1810] text-[#2C1810] hover:bg-[#2C1810] hover:text-white'}`}
                                    >
                                        {questCompleted ? "Grace Accomplished" : "I Have Done This"}
                                    </button>
                                </div>

                                {/* Right Side: Holy Habits */}
                                <div>
                                    <div className="mb-6 text-center md:text-left">
                                        <h3 className="font-serif text-2xl text-[#2C1810] italic mb-1">Holy Habits to Keep in Mind</h3>
                                        <p className="text-xs font-bold uppercase tracking-widest text-stone-400">Daily Disciplines</p>
                                    </div>

                                    <div className="space-y-3">
                                        {habits.map(habit => (
                                            <div 
                                                key={habit.id}
                                                onClick={() => toggleHabit(habit.id)}
                                                className={`flex items-center gap-4 p-3 rounded-xl transition-all cursor-pointer border ${habit.completed ? 'bg-amber-50 border-amber-200' : 'bg-transparent border-stone-100 hover:border-stone-300'}`}
                                            >
                                                <div className={`w-10 h-10 rounded-full flex items-center justify-center border transition-all ${habit.completed ? 'bg-amber-500 border-amber-500 text-white' : 'bg-white border-stone-200 text-stone-400'}`}>
                                                    {habit.completed ? <CheckCircle className="w-5 h-5" /> : <habit.icon className="w-4 h-4" />}
                                                </div>
                                                <div className="flex-1">
                                                    <span className={`font-serif text-lg ${habit.completed ? 'text-[#2C1810] line-through decoration-amber-300/50' : 'text-stone-600'}`}>{habit.label}</span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                    
                                    <div className="mt-6 text-center">
                                        <div className="inline-flex items-center gap-2 px-4 py-1.5 bg-[#2C1810] text-amber-100 rounded-full font-serif italic text-sm">
                                            <Flame className="w-3 h-3 fill-amber-100" /> {streak} Days of Faithfulness
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                    {/* THE TRIPTYCH NAVIGATION (Cathedral Windows) */}
                    <div className="max-w-7xl mx-auto px-6">
                        <h2 className="text-center font-serif text-3xl text-[#2C1810] mb-8 italic">Pathways to Wisdom</h2>
                        
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6 h-auto md:h-[400px]">
                            
                            {/* Panel 1: The Scroll (Blog) */}
                            <div onClick={() => setView('blog')} className="group relative rounded-[50px] md:rounded-t-full md:rounded-b-none border-8 border-white shadow-xl overflow-hidden cursor-pointer">
                                <img src="https://images.unsplash.com/photo-1519681393784-d8e5b5a4570e?q=80&w=2070&auto=format&fit=crop" className="absolute inset-0 w-full h-full object-cover transition-transform duration-700 group-hover:scale-110 opacity-90" />
                                <div className="absolute inset-0 bg-gradient-to-t from-[#2C1810]/90 via-[#2C1810]/20 to-transparent"></div>
                                <div className="absolute bottom-0 left-0 right-0 p-8 text-center">
                                    <div className="w-10 h-10 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center mx-auto mb-3 text-white">
                                        <BookOpen className="w-5 h-5" />
                                    </div>
                                    <h3 className="font-serif text-2xl text-white mb-1">The Scroll</h3>
                                    <p className="text-amber-100/80 font-serif italic text-xs">Daily readings & wisdom</p>
                                </div>
                            </div>

                            {/* Panel 2: The Sanctuary (AI) */}
                            <div onClick={() => setView('ai')} className="group relative rounded-[50px] md:rounded-t-full md:rounded-b-none border-8 border-white shadow-xl overflow-hidden cursor-pointer mt-0 md:-mt-8 z-10">
                                <img src="https://images.unsplash.com/photo-1437603568260-1950d3ca6eab?q=80&w=2070&auto=format&fit=crop" className="absolute inset-0 w-full h-full object-cover transition-transform duration-700 group-hover:scale-110 opacity-90" />
                                <div className="absolute inset-0 bg-gradient-to-t from-[#2C1810]/90 via-[#2C1810]/20 to-transparent"></div>
                                <div className="absolute bottom-0 left-0 right-0 p-8 text-center">
                                    <div className="w-10 h-10 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center mx-auto mb-3 text-white">
                                        <Sparkles className="w-5 h-5" />
                                    </div>
                                    <h3 className="font-serif text-2xl text-white mb-1">The Sanctuary</h3>
                                    <p className="text-amber-100/80 font-serif italic text-xs">Speak with the Scholar</p>
                                </div>
                            </div>

                            {/* Panel 3: The Bazaar (Shop) */}
                            <div onClick={() => setView('shop')} className="group relative rounded-[50px] md:rounded-t-full md:rounded-b-none border-8 border-white shadow-xl overflow-hidden cursor-pointer">
                                <img src="https://images.unsplash.com/photo-1542642838-345388e3639d?q=80&w=2070&auto=format&fit=crop" className="absolute inset-0 w-full h-full object-cover transition-transform duration-700 group-hover:scale-110 opacity-90" />
                                <div className="absolute inset-0 bg-gradient-to-t from-[#2C1810]/90 via-[#2C1810]/20 to-transparent"></div>
                                <div className="absolute bottom-0 left-0 right-0 p-8 text-center">
                                    <div className="w-10 h-10 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center mx-auto mb-3 text-white">
                                        <ShoppingBag className="w-5 h-5" />
                                    </div>
                                    <h3 className="font-serif text-2xl text-white mb-1">The Bazaar</h3>
                                    <p className="text-amber-100/80 font-serif italic text-xs">Tools for the journey</p>
                                </div>
                            </div>

                        </div>
                    </div>

                    {/* Verse of the Moment - REDUCED PADDING */}
                    <div className="max-w-3xl mx-auto text-center relative pt-12 pb-4 px-6">
                        <h2 className="font-serif text-3xl md:text-4xl text-[#2C1810] leading-tight mb-4">
                            "{DAILY_INSPIRATION.verse.text}"
                        </h2>
                        <span className="font-sans text-xs font-bold uppercase tracking-[0.3em] text-stone-400">
                            {DAILY_INSPIRATION.verse.reference}
                        </span>
                    </div>
                </div>
            );
        }

        // --- UPDATED LAW VIEW (MANUSCRIPT STYLE) ---
        function LawView() {
            const [activeModal, setActiveModal] = useState(null);
            const [revealedIds, setRevealedIds] = useState([]);

            // Simple intersection observer effect for scroll reveal
            useEffect(() => {
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const id = entry.target.getAttribute('data-id');
                            setRevealedIds(prev => [...prev, parseInt(id)]);
                        }
                    });
                }, { threshold: 0.1 });

                const elements = document.querySelectorAll('.commandment-card');
                elements.forEach(el => observer.observe(el));

                return () => observer.disconnect();
            }, []);

            // Triggers browser native print window
            const handlePrint = () => {
                window.print();
            };

            return (
                <div className="animate-fade-in bg-[#FDFBF7]">
                    
                    {/* REDESIGNED HERO: HOLY AESTHETIC - REDUCED PADDING */}
                    <div className="relative w-full overflow-hidden border-b border-stone-100">
                        {/* 1. Base Gradient */}
                        <div className="absolute inset-0 bg-gradient-to-b from-[#F3E5D0] via-[#FDFBF7] to-[#FDFBF7] z-0"></div>
                        
                        {/* 2. Texture Overlay */}
                        <div className="absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/noise-lines.png')] z-0 mix-blend-multiply pointer-events-none"></div>
                        
                        {/* 3. Divine Light Burst */}
                        <div className="absolute top-[-50%] left-1/2 -translate-x-1/2 w-[120%] h-[800px] bg-[radial-gradient(circle_at_center,_rgba(251,191,36,0.15),_transparent_60%)] blur-3xl z-0 pointer-events-none"></div>

                        <div className="pt-12 pb-10 px-6 max-w-5xl mx-auto text-center relative z-10">
                            <h1 className="text-5xl md:text-8xl font-cinzel text-[#2C1810] leading-tight mb-4 drop-shadow-sm">
                                THE TEN <br/> COMMANDMENTS
                            </h1>
                            <div className="max-w-2xl mx-auto space-y-4">
                                <p className="font-cinzel text-xs md:text-sm font-bold uppercase tracking-[0.2em] text-amber-800">
                                    A Foundation for Moral Law & Spiritual Liberty
                                </p>
                                <p className="font-serif text-lg md:text-xl text-stone-700 leading-relaxed italic">
                                    "Written on stone by the finger of God, these ancient words have shaped history, law, and the human conscience for thousands of years."
                                </p>
                            </div>
                            <div className="mt-8 flex justify-center">
                                <button 
                                    onClick={() => document.getElementById('manuscript').scrollIntoView({ behavior: 'smooth' })}
                                    className="group flex flex-col items-center gap-2 text-[#2C1810] font-cinzel font-bold text-xs uppercase tracking-[0.2em] hover:text-amber-800 transition-colors"
                                >
                                    Read The Law
                                    <div className="h-6 w-px bg-stone-300 group-hover:bg-amber-800 transition-colors"></div>
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* THE MANUSCRIPT - REDUCED PADDING */}
                    <div id="manuscript" className="pt-8 pb-16 w-full max-w-[95%] mx-auto px-4 relative z-10">
                        <div className="mb-8 text-center animate-fade-in delay-100">
                            <p className="font-serif text-xl md:text-2xl text-stone-600 italic leading-relaxed max-w-4xl mx-auto mb-4">
                                "We look at the commandments not to earn salvation, but to understand the character of the King."
                            </p>
                            <button 
                                onClick={handlePrint}
                                className="inline-flex items-center gap-2 px-6 py-2 bg-white border border-stone-200 text-stone-600 font-cinzel text-[10px] font-bold uppercase tracking-widest rounded-sm transition-all shadow-sm hover:shadow-md hover:border-amber-200"
                            >
                                <Printer className="w-3 h-3" /> Download PDF
                            </button>
                        </div>

                        {/* PARCHMENT CONTAINER */}
                        <div className="relative bg-white p-8 md:p-12 shadow-2xl rounded-sm border border-stone-100">
                            {/* Paper Texture Effect inside Manuscript */}
                            <div className="absolute inset-0 bg-[#FDFBF7] opacity-30 pointer-events-none mix-blend-multiply"></div>
                            
                            {/* Decorative corners */}
                            <div className="absolute top-0 left-0 w-8 h-8 border-t border-l border-stone-400"></div>
                            <div className="absolute top-0 right-0 w-8 h-8 border-t border-r border-stone-400"></div>
                            <div className="absolute bottom-0 left-0 w-8 h-8 border-b border-l border-stone-400"></div>
                            <div className="absolute bottom-0 right-0 w-8 h-8 border-b border-r border-stone-400"></div>

                            <div className="space-y-8 relative z-10">
                                <div className="absolute left-6 md:-left-8 top-0 bottom-0 w-px bg-stone-200 -z-10 hidden md:block"></div>

                                {COMMANDMENTS.map((cmd) => {
                                    const isVisible = revealedIds.includes(cmd.id);
                                    return (
                                        <div 
                                            key={cmd.id}
                                            data-id={cmd.id}
                                            onClick={() => setActiveModal(cmd)}
                                            className={`commandment-card group relative md:pl-12 cursor-pointer transition-all duration-1000 ease-out border-b border-stone-100 pb-6 last:border-0 ${isVisible ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-20'}`}
                                        >
                                            <div className="hidden md:flex absolute -left-12 top-2 w-10 h-10 bg-[#FDFBF7] border border-stone-300 items-center justify-center rounded-full font-cinzel font-bold text-stone-400 group-hover:border-amber-600 group-hover:text-amber-600 group-hover:scale-125 transition-all duration-500 z-10 shadow-sm">
                                                {cmd.id}
                                            </div>

                                            <div className="transition-all duration-500 group-hover:translate-x-2">
                                                <div className="md:hidden text-amber-700 font-bold font-cinzel text-xl mb-1 flex items-center gap-3">
                                                    <span className="w-8 h-px bg-amber-700"></span> {cmd.id}
                                                </div>
                                                <h2 className="text-2xl md:text-4xl font-cinzel text-[#2C1810] mb-2 group-hover:text-amber-700 transition-colors leading-tight">
                                                    {cmd.meaning}
                                                </h2>
                                                <p className="text-stone-400 font-serif italic text-lg md:text-xl line-through decoration-transparent group-hover:decoration-stone-300 group-hover:text-stone-500 transition-all">
                                                    {cmd.text}
                                                </p>
                                                <div className="mt-3 opacity-0 group-hover:opacity-100 transition-opacity text-xs font-bold uppercase tracking-widest text-amber-700 flex items-center gap-2 font-sans">
                                                    Uncover Meaning <ArrowRight className="w-3 h-3" />
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </div>

                    {/* MODAL FOR DEEP DIVE */}
                    {activeModal && (
                        <div className="fixed inset-0 z-[100] flex items-center justify-center px-4">
                            <div className="absolute inset-0 bg-[#2C1810]/60 backdrop-blur-sm transition-opacity" onClick={() => setActiveModal(null)}></div>
                            <div className="bg-[#FDFBF7] w-full max-w-2xl max-h-[90vh] overflow-y-auto rounded-sm shadow-2xl relative animate-scale-in p-10 md:p-16 border border-stone-200">
                                <div className="absolute inset-0 opacity-10 pointer-events-none bg-[url('https://www.transparenttextures.com/patterns/noise-lines.png')]"></div>
                                
                                <button 
                                    onClick={() => setActiveModal(null)}
                                    className="absolute top-6 right-6 p-2 text-stone-400 hover:text-stone-900 transition-colors"
                                >
                                    <X className="w-6 h-6" />
                                </button>
                                
                                <div className="mb-8 flex justify-center">
                                    <span className="text-9xl font-cinzel text-stone-100 font-bold -mt-8">{activeModal.id}</span>
                                </div>

                                <div className="text-center mb-12 relative -mt-20">
                                    <h2 className="text-4xl md:text-5xl font-cinzel text-[#2C1810] mb-4">{activeModal.text}</h2>
                                    <div className="flex items-center justify-center gap-4">
                                        <span className="h-px w-12 bg-amber-700"></span>
                                        <p className="text-amber-700 font-bold uppercase text-xs tracking-[0.2em] font-sans">{activeModal.meaning}</p>
                                        <span className="h-px w-12 bg-amber-700"></span>
                                    </div>
                                </div>
                                
                                <div className="prose prose-stone prose-lg mx-auto font-serif text-xl leading-relaxed text-stone-700">
                                    <p className="first-letter:text-6xl first-letter:font-cinzel first-letter:text-[#2C1810] first-letter:float-left first-letter:mr-4 first-letter:mt-[-12px]">
                                        {activeModal.deepDive}
                                    </p>

                                    <div className="mt-12 pt-8 border-t border-double border-stone-200">
                                        <h4 className="text-xs font-bold uppercase tracking-widest text-stone-400 mb-6 text-center font-sans">Scripture References</h4>
                                        <div className="flex flex-wrap justify-center gap-3">
                                            {activeModal.scriptures.map(s => (
                                                <span key={s} className="bg-white border border-stone-200 px-4 py-2 text-sm font-bold text-stone-600 rounded-sm font-sans uppercase tracking-wider shadow-sm">
                                                    {s}
                                                </span>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        function BlogView() {
            const [activePost, setActivePost] = useState(null);
            const [activeCategory, setActiveCategory] = useState("All");
            
            const categories = ["All", "Discipline", "Theology", "Culture"];
            const filteredPosts = activeCategory === "All" ? BLOG_POSTS : BLOG_POSTS.filter(p => p.category === activeCategory);

            return (
                <div className="animate-fade-in bg-[#FDFBF7]">
                    
                    {/* REDESIGNED HERO: HOLY AESTHETIC - REDUCED PADDING */}
                    <div className="relative w-full overflow-hidden border-b border-stone-100">
                        <div className="absolute inset-0 bg-gradient-to-b from-[#F3E5D0] via-[#FDFBF7] to-[#FDFBF7] z-0"></div>
                        <div className="absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/noise-lines.png')] z-0 mix-blend-multiply pointer-events-none"></div>
                        <div className="absolute top-[-50%] left-1/2 -translate-x-1/2 w-[120%] h-[800px] bg-[radial-gradient(circle_at_center,_rgba(251,191,36,0.15),_transparent_60%)] blur-3xl z-0 pointer-events-none"></div>

                        <div className="pt-12 pb-10 px-6 max-w-6xl mx-auto text-center relative z-10">
                            <h2 className="font-cinzel text-5xl md:text-8xl text-[#2C1810] mb-4 drop-shadow-sm">The Daily Scroll</h2>
                            <div className="w-24 h-1 bg-amber-300 mx-auto mb-6 rounded-full"></div>
                            <p className="font-serif text-lg md:text-2xl text-stone-700 italic max-w-2xl mx-auto leading-relaxed">
                                Reflections on theology, culture, and the quiet work of grace in a loud world.
                            </p>
                        </div>
                    </div>

                    <div className="max-w-6xl mx-auto px-6 pt-10 pb-16 relative z-10">
                        {/* Daily Inspiration Dashboard */}
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-12">
                            {/* Verse Card */}
                            <div className="bg-[#2C1810] rounded-[2rem] p-8 text-white relative overflow-hidden flex flex-col justify-between shadow-2xl border border-stone-800">
                                <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/noise-lines.png')] opacity-10 mix-blend-overlay"></div>
                                <div className="absolute top-0 right-0 p-10 opacity-10"><BookOpen className="w-40 h-40" /></div>
                                <div className="relative z-10">
                                    <span className="text-amber-200 font-bold text-xs uppercase tracking-widest mb-4 block">Verse of the Day</span>
                                    <p className="font-serif italic text-xl md:text-2xl leading-relaxed text-amber-50">"{DAILY_INSPIRATION.verse.text}"</p>
                                </div>
                                <div className="mt-8 border-t border-stone-700 pt-4 relative z-10">
                                    <span className="text-stone-400 font-bold text-sm tracking-wide">{DAILY_INSPIRATION.verse.reference}</span>
                                </div>
                            </div>

                            {/* Quote & Action */}
                            <div className="lg:col-span-2 flex flex-col gap-6">
                                <div className="bg-white p-8 rounded-[2rem] border border-stone-100 shadow-lg flex flex-col justify-center relative overflow-hidden flex-1 group hover:shadow-xl transition-all duration-500">
                                    <Feather className="absolute top-8 right-8 w-8 h-8 text-stone-200 group-hover:text-amber-200 transition-colors" />
                                    <p className="text-xl md:text-3xl text-stone-800 font-serif italic mb-4 leading-relaxed">"{DAILY_INSPIRATION.quote.text}"</p>
                                    <div className="flex items-center gap-4">
                                        <div className="h-0.5 w-12 bg-amber-400"></div>
                                        <span className="text-sm font-bold uppercase tracking-widest text-stone-400">{DAILY_INSPIRATION.quote.author}</span>
                                    </div>
                                </div>

                                <div className="bg-gradient-to-r from-amber-50 to-[#FDFBF7] p-8 rounded-[2rem] border border-amber-100 flex items-center gap-6 flex-1 shadow-sm">
                                    <div className="bg-white p-4 rounded-2xl shadow-sm text-amber-600 shrink-0 border border-amber-50">
                                        <Sparkles className="w-6 h-6" />
                                    </div>
                                    <div>
                                        <span className="text-amber-700 font-bold text-xs uppercase tracking-widest mb-1 block">Kingdom Action</span>
                                        <h4 className="font-cinzel text-lg text-stone-900 mb-1">{DAILY_INSPIRATION.action.title}</h4>
                                        <p className="text-sm text-stone-600 leading-relaxed font-serif italic">{DAILY_INSPIRATION.action.task}</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Category Filter */}
                        <div className="flex items-center justify-between mb-8 border-b border-stone-200 pb-4">
                            <h3 className="font-cinzel font-bold text-xl md:text-2xl text-stone-900">Recent Writings</h3>
                            <div className="flex gap-2">
                                {categories.map(cat => (
                                    <button 
                                        key={cat}
                                        onClick={() => setActiveCategory(cat)}
                                        className={`px-4 py-1.5 rounded-sm text-[10px] md:text-xs font-bold uppercase tracking-wide transition-all ${activeCategory === cat ? 'bg-[#2C1810] text-amber-50' : 'bg-white text-stone-500 hover:bg-stone-100 border border-stone-200'}`}
                                    >
                                        {cat}
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* Articles Grid - REDUCED GAP */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                            {filteredPosts.map(post => (
                                <div key={post.id} onClick={() => setActivePost(post)} className="group cursor-pointer">
                                    <div className="bg-white rounded-[1rem] overflow-hidden border border-stone-100 shadow-sm group-hover:shadow-2xl transition-all duration-500 h-full flex flex-col hover:-translate-y-2">
                                        <div className="h-48 bg-stone-100 relative overflow-hidden">
                                            <div className="absolute inset-0 bg-gradient-to-t from-stone-900/40 to-transparent"></div>
                                            <span className="absolute bottom-4 left-4 bg-white/90 backdrop-blur px-3 py-1 rounded-sm text-[9px] font-bold text-stone-900 uppercase tracking-widest border border-stone-200">{post.category}</span>
                                        </div>
                                        <div className="p-6 flex-1 flex flex-col">
                                            <div className="flex items-center gap-3 text-[9px] font-bold text-stone-400 mb-3 uppercase tracking-widest">
                                                <span>{post.date}</span> â¢ <span>{post.readTime}</span>
                                            </div>
                                            <h3 className="font-cinzel text-lg text-stone-900 mb-3 group-hover:text-amber-700 transition-colors leading-tight">{post.title}</h3>
                                            <p className="text-stone-500 text-xs leading-relaxed mb-6 line-clamp-3 flex-1 font-serif">{post.excerpt}</p>
                                            <div className="flex items-center text-[10px] font-bold text-[#2C1810] uppercase tracking-widest group-hover:gap-2 transition-all border-t border-stone-100 pt-4">
                                                Read Article <ArrowRight className="w-3 h-3 ml-1" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Reading Modal */}
                    {activePost && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center px-4 bg-[#2C1810]/80 backdrop-blur-md" onClick={() => setActivePost(null)}>
                            <div className="bg-[#FDFBF7] w-full max-w-3xl max-h-[90vh] overflow-y-auto rounded-sm shadow-2xl relative animate-scale-in border border-stone-200" onClick={e => e.stopPropagation()}>
                                <div className="absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/noise-lines.png')] pointer-events-none mix-blend-multiply"></div>
                                <button onClick={() => setActivePost(null)} className="sticky top-8 right-8 float-right p-3 bg-stone-100 rounded-full hover:bg-stone-200 transition-colors z-10"><X className="w-5 h-5 text-stone-600" /></button>
                                <div className="p-12 md:p-24 relative z-10">
                                    <div className="text-center mb-16">
                                        <span className="text-amber-700 font-bold uppercase tracking-[0.2em] text-xs mb-6 block">{activePost.category}</span>
                                        <h2 className="font-cinzel text-4xl md:text-6xl text-[#2C1810] mb-8 leading-tight">{activePost.title}</h2>
                                        <div className="flex justify-center items-center gap-6 text-xs font-bold text-stone-400 uppercase tracking-widest">
                                            <span>{activePost.date}</span>
                                            <span className="w-1.5 h-1.5 bg-stone-300 rounded-full"></span>
                                            <span>{activePost.readTime}</span>
                                        </div>
                                    </div>
                                    <div className="prose prose-lg mx-auto text-stone-700 font-serif leading-loose first-letter:text-5xl first-letter:font-cinzel first-letter:text-[#2C1810] first-letter:float-left first-letter:mr-4 first-letter:mt-[-10px]">
                                        {activePost.content}
                                    </div>
                                    <div className="mt-20 pt-10 border-t border-stone-200 text-center">
                                        <p className="text-stone-400 font-serif italic">Share this reflection...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        function ResourcesView({ resources, addToCart }) {
            const [filter, setFilter] = useState('All');
            const [giftMode, setGiftMode] = useState(false);
            const [quickViewItem, setQuickViewItem] = useState(null);
            
            const categories = ['All', 'Free Guides', 'Study Tools', 'Wearable Faith'];
            const filtered = filter === 'All' ? resources : resources.filter(p => p.category === filter);

            return (
                <div className="animate-fade-in bg-[#FDFBF7]">
                    
                    {/* REDESIGNED HERO: HOLY AESTHETIC - REDUCED PADDING */}
                    <div className="relative w-full overflow-hidden border-b border-stone-100">
                        <div className="absolute inset-0 bg-gradient-to-b from-[#F3E5D0] via-[#FDFBF7] to-[#FDFBF7] z-0"></div>
                        <div className="absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/noise-lines.png')] z-0 mix-blend-multiply pointer-events-none"></div>
                        <div className="absolute top-[-50%] left-1/2 -translate-x-1/2 w-[120%] h-[800px] bg-[radial-gradient(circle_at_center,_rgba(251,191,36,0.15),_transparent_60%)] blur-3xl z-0 pointer-events-none"></div>

                        <div className="pt-12 pb-10 px-6 max-w-7xl mx-auto relative z-10 flex flex-col md:flex-row items-end justify-between gap-8">
                            <div>
                                <h2 className="font-cinzel text-5xl md:text-8xl text-[#2C1810] mb-4 drop-shadow-sm">The Bazaar</h2>
                                <p className="font-serif text-lg md:text-2xl text-stone-700 italic max-w-md leading-relaxed">
                                    Curated tools for the modern disciple. Equip yourself for the journey.
                                </p>
                            </div>
                            
                            <div onClick={() => setGiftMode(!giftMode)} className={`cursor-pointer flex items-center gap-4 p-2 pl-6 pr-2 rounded-full border-2 transition-all duration-300 select-none shadow-sm ${giftMode ? 'border-amber-200 bg-amber-50' : 'border-stone-200 bg-white hover:border-stone-300'}`}>
                                <div className="text-right">
                                    <span className={`block text-xs font-bold uppercase tracking-widest ${giftMode ? 'text-amber-800' : 'text-stone-400'}`}>{giftMode ? "Gift Mode On" : "Personal Mode"}</span>
                                    <span className="block text-[10px] text-stone-400 font-bold mt-1 font-sans">{giftMode ? "Attach a prayer" : "Equip yourself"}</span>
                                </div>
                                <div className={`w-10 h-10 rounded-full flex items-center justify-center text-white shadow-sm transition-all ${giftMode ? 'bg-amber-600' : 'bg-stone-300'}`}>
                                    {giftMode ? <Gift className="w-4 h-4" /> : <ShoppingBag className="w-4 h-4" />}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto px-6 pt-10 pb-16 relative z-10">
                        {/* Filters */}
                        <div className="flex flex-wrap gap-3 mb-10">
                            {categories.map(cat => (
                                <button key={cat} onClick={() => setFilter(cat)} className={`px-5 py-2 rounded-sm text-xs font-bold uppercase tracking-wider transition-all ${filter === cat ? 'bg-[#2C1810] text-amber-50 shadow-lg' : 'bg-white text-stone-500 hover:bg-stone-100 border border-stone-200'}`}>
                                    {cat}
                                </button>
                            ))}
                        </div>

                        {/* Grid - REDUCED GAP */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {filtered.map((item) => (
                                <div key={item.id} className="group bg-white rounded-[2rem] border border-stone-100 p-6 hover:shadow-2xl transition-all duration-500 flex flex-col relative overflow-hidden">
                                    <div className={`absolute top-0 right-0 w-48 h-48 ${item.color} rounded-bl-full opacity-30 -mr-12 -mt-12 transition-transform group-hover:scale-150 duration-700`}></div>
                                    
                                    <div className={`w-16 h-16 ${item.color} rounded-3xl flex items-center justify-center text-stone-700 mb-6 group-hover:rotate-12 transition-transform duration-500 cursor-pointer shadow-sm`} onClick={() => setQuickViewItem(item)}>
                                        <item.icon className="w-6 h-6" />
                                    </div>

                                    <div className="mb-2">
                                        <span className="text-[9px] font-bold uppercase tracking-[0.2em] text-stone-400">{item.category}</span>
                                    </div>
                                    <h3 className="font-cinzel text-xl text-stone-900 mb-2 cursor-pointer hover:text-amber-700 transition-colors" onClick={() => setQuickViewItem(item)}>{item.name}</h3>
                                    <p className="text-stone-500 text-xs mb-8 leading-relaxed font-serif italic">{item.description}</p>

                                    <div className="mt-auto flex items-center justify-between pt-6 border-t border-stone-50">
                                        <div className="font-cinzel font-bold text-lg text-stone-900">{item.price === 0 ? "Free" : `$${item.price}`}</div>
                                        <button onClick={() => addToCart(item, giftMode ? "Gift" : null)} className={`px-5 py-2 rounded-sm text-[10px] font-bold uppercase tracking-widest transition-colors ${giftMode ? 'bg-amber-100 text-amber-800 hover:bg-amber-200' : 'bg-[#2C1810] text-white hover:bg-stone-700'}`}>
                                            {giftMode ? "Gift This" : "Add to Cart"}
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Quick View Modal */}
                    {quickViewItem && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center px-4 bg-[#2C1810]/80 backdrop-blur-md" onClick={() => setQuickViewItem(null)}>
                            <div className="bg-[#FDFBF7] w-full max-w-lg rounded-[2.5rem] p-10 shadow-2xl relative animate-scale-in border border-stone-200" onClick={e => e.stopPropagation()}>
                                <div className="absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/noise-lines.png')] pointer-events-none mix-blend-multiply"></div>
                                <button onClick={() => setQuickViewItem(null)} className="absolute top-6 right-6 p-3 bg-stone-100 rounded-full hover:bg-stone-200 transition-colors z-10"><X className="w-5 h-5 text-stone-500" /></button>
                                <div className={`w-24 h-24 ${quickViewItem.color} rounded-[2rem] flex items-center justify-center text-stone-700 mb-8 mx-auto shadow-inner relative z-10`}>
                                    <quickViewItem.icon className="w-10 h-10" />
                                </div>
                                <h2 className="font-cinzel text-3xl text-center mb-4 text-[#2C1810] relative z-10">{quickViewItem.name}</h2>
                                <p className="text-center text-stone-600 mb-8 leading-relaxed px-4 font-serif italic relative z-10">{quickViewItem.description}</p>
                                <div className="bg-white p-6 rounded-2xl mb-8 border border-stone-100 relative z-10 shadow-sm">
                                    <h4 className="font-bold text-[10px] uppercase tracking-widest text-stone-400 mb-3">Product Details</h4>
                                    <p className="text-sm text-stone-600 font-medium leading-relaxed font-sans">High quality materials designed for daily use. Perfect for personal study or as a gift.</p>
                                </div>
                                <button onClick={() => { addToCart(quickViewItem); setQuickViewItem(null); }} className="w-full bg-[#2C1810] text-amber-50 font-bold py-4 rounded-xl hover:bg-stone-800 transition-colors shadow-lg uppercase tracking-widest text-xs relative z-10">
                                    Add to Cart - {quickViewItem.price === 0 ? "Free" : `$${quickViewItem.price}`}
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        function StudyView({ resources, addToCart, user }) {
            const [messages, setMessages] = useState([
                { role: 'assistant', text: "Grace and peace to you. I am here to help you study scripture, understand the Commandments, or find historical context for your faith. What is on your mind?" }
            ]);
            const [input, setInput] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [suggestedResource, setSuggestedResource] = useState(null);
            const [isListening, setIsListening] = useState(false);
            const [isSpeaking, setIsSpeaking] = useState(false);
            const [voiceMode, setVoiceMode] = useState(false); 
            
            // NEW TOOLS: More functional, less generic
            const [socraticMode, setSocraticMode] = useState(false);
            const [practicalMode, setPracticalMode] = useState(false);

            const scrollRef = useRef(null);

            useEffect(() => {
                if (scrollRef.current) scrollRef.current.scrollTop = scrollRef.current.scrollHeight;
            }, [messages, isLoading]);

            // Cleanup speech synthesis on unmount
            useEffect(() => {
                return () => {
                    if ('speechSynthesis' in window) {
                        window.speechSynthesis.cancel();
                    }
                };
            }, []);

            const speak = (text) => {
                if (!('speechSynthesis' in window)) return;
                
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                const voices = window.speechSynthesis.getVoices();
                const preferredVoice = voices.find(v => v.name.includes('Google US English')) || voices[0];
                if (preferredVoice) utterance.voice = preferredVoice;
                
                utterance.onstart = () => setIsSpeaking(true);
                utterance.onend = () => setIsSpeaking(false);
                utterance.onerror = () => setIsSpeaking(false);
                
                window.speechSynthesis.speak(utterance);
            };

            const startListening = () => {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    const recognition = new SpeechRecognition();
                    recognition.lang = 'en-US';
                    recognition.interimResults = false;
                    recognition.maxAlternatives = 1;

                    recognition.onstart = () => setIsListening(true);
                    
                    recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        setInput(transcript);
                        handleSend(transcript);
                    };

                    recognition.onerror = (event) => {
                        console.error("Speech recognition error", event.error);
                        setIsListening(false);
                    };

                    recognition.onend = () => setIsListening(false);
                    recognition.start();
                } else {
                    alert("Voice input is not supported in this browser.");
                }
            };

            const detectIntentAndRecommend = (text) => {
                const lowerText = text.toLowerCase();
                const match = resources.find(p => p.keywords.some(k => lowerText.includes(k)));
                if (match) setSuggestedResource(match);
            };

            const handleSend = async (overrideInput = null) => {
                const textToSend = overrideInput || input;
                if (!textToSend.trim()) return;
                
                if (isSpeaking) {
                    window.speechSynthesis.cancel();
                    setIsSpeaking(false);
                }

                const userMsg = { role: 'user', text: textToSend };
                setMessages(prev => [...prev, userMsg]);
                setInput('');
                setIsLoading(true);

                detectIntentAndRecommend(textToSend);

                try {
                    const historyText = messages.map(m => `${m.role === 'user' ? 'User' : 'Teacher'}: ${m.text}`).join('\n');
                    
                    // NEW: Distinct, high-impact instructions
                    let modeInstructions = "";
                    
                    if (socraticMode) {
                        modeInstructions += `
                        [MODE: THE RABBI]
                        - Do NOT give direct answers.
                        - Instead, ask 1-2 probing, Socratic questions that guide the user to discover the truth themselves.
                        - Use parables or "what if" scenarios.
                        - Your goal is to make the user think, not just to inform them.
                        `;
                    }
                    
                    if (practicalMode) {
                        modeInstructions += `
                        [MODE: LIFE APPLICATION]
                        - Ignore abstract theology and history.
                        - Focus entirely on 21st-century application (technology, workplace, modern relationships).
                        - Give concrete, actionable steps.
                        - Use modern analogies (e.g., "like a software update for the soul" or "social media algorithms").
                        `;
                    }

                    const fullPrompt = `${SYSTEM_PROMPT}${modeInstructions}\n\nConversation Context:\n${historyText}\nUser Question: ${textToSend}\nTeacher Response:`;

                    let aiText = "I am meditating on that. Please ask again.";

                    if (GEMINI_API_KEY) {
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${GEMINI_API_KEY}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ contents: [{ parts: [{ text: fullPrompt }] }] })
                        });

                        if (!response.ok) throw new Error('API Error');
                        const data = await response.json();
                        aiText = data.candidates?.[0]?.content?.parts?.[0]?.text || aiText;
                    } else {
                        // Fallback response
                        await new Promise(r => setTimeout(r, 1500));
                        aiText = "The scriptures remind us to be anxious for nothing, but in everything by prayer and supplication, with thanksgiving, let your requests be made known to God. (Philippians 4:6) [Demo Mode: Set API Key for full experience]";
                    }
                    
                    setMessages(prev => [...prev, { role: 'assistant', text: aiText }]);
                    
                    if (voiceMode) {
                        speak(aiText);
                    }

                } catch (error) {
                    const errMsg = "Forgive me, I cannot access the library at this moment.";
                    setMessages(prev => [...prev, { role: 'assistant', text: errMsg }]);
                    speak(errMsg);
                } finally {
                    setIsLoading(false);
                }
            };

            const quickTopics = [
                { text: "Why do the Commandments matter today?", icon: BookOpen },
                { text: "Tell me about Grace vs. Law.", icon: Shield },
                { text: "How do I start praying?", icon: Heart },
                { text: "What is biblical Contentment?", icon: Sparkles }
            ];

            return (
                // FIXED: Changed height calculation to fit viewport exactly minus header (6rem/96px)
                // Use dvh for mobile browser bar support
                <div className="h-[calc(100dvh-6rem)] flex flex-col md:flex-row animate-fade-in relative overflow-hidden bg-[#FDFBF7]">
                    {/* WARM BACKGROUND FOR STUDY PAGE */}
                    <div className="absolute inset-0 bg-gradient-to-b from-[#F3E5D0] via-[#FDFBF7] to-[#FDFBF7] z-0 opacity-50"></div>
                    <div className="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/noise-lines.png')] z-0 mix-blend-multiply pointer-events-none"></div>

                    {/* --- STANDARD MODE LAYOUT --- */}
                    {!voiceMode && (
                        <>
                            {/* Sidebar / Context Panel */}
                            <div className="hidden md:flex w-80 border-r border-stone-200/50 p-8 flex-col bg-[#FDFBF7]/50 backdrop-blur-sm z-20">
                                <h3 className="font-bold text-xs uppercase tracking-widest text-stone-400 mb-6 font-sans">Study Tools</h3>
                                
                                {/* Voice Toggle Switch */}
                                <div className="mb-6 p-4 bg-white border border-stone-100 rounded-xl shadow-sm transition-all hover:shadow-md">
                                    <div className="flex items-center justify-between mb-2">
                                        <div className="flex items-center gap-3">
                                            <div className={`p-2 rounded-full ${voiceMode ? 'bg-amber-100 text-amber-600' : 'bg-stone-100 text-stone-400'}`}>
                                                <Mic className="w-4 h-4" />
                                            </div>
                                            <span className="text-xs font-bold uppercase text-stone-600 tracking-wider font-sans">Voice Tool</span>
                                        </div>
                                        
                                        <button 
                                            onClick={() => setVoiceMode(true)}
                                            className="w-10 h-6 bg-stone-200 rounded-full relative transition-colors duration-300 hover:bg-stone-300"
                                        >
                                            <div className="absolute left-1 top-1 w-4 h-4 bg-white rounded-full shadow-sm transition-transform duration-300"></div>
                                        </button>
                                    </div>
                                </div>

                                {/* "The Rabbi" Toggle */}
                                <div 
                                    onClick={() => { setSocraticMode(!socraticMode); setPracticalMode(false); }}
                                    className={`mb-4 p-4 border rounded-xl shadow-sm transition-all hover:shadow-md cursor-pointer group ${socraticMode ? 'bg-indigo-50 border-indigo-200 ring-1 ring-indigo-200' : 'bg-white border-stone-100'}`}
                                >
                                    <div className="flex items-center justify-between mb-2">
                                        <div className="flex items-center gap-3">
                                            <div className={`p-2 rounded-full ${socraticMode ? 'bg-indigo-200 text-indigo-800' : 'bg-stone-100 text-stone-400 group-hover:text-indigo-500'}`}>
                                                <Target className="w-4 h-4" />
                                            </div>
                                            <span className={`text-xs font-bold uppercase tracking-wider font-sans ${socraticMode ? 'text-indigo-900' : 'text-stone-600'}`}>The Rabbi</span>
                                        </div>
                                        
                                        <div className={`w-10 h-6 rounded-full relative transition-colors duration-300 ${socraticMode ? 'bg-indigo-600' : 'bg-stone-200'}`}>
                                            <div className={`absolute top-1 w-4 h-4 bg-white rounded-full shadow-sm transition-transform duration-300 ${socraticMode ? 'left-5' : 'left-1'}`}></div>
                                        </div>
                                    </div>
                                    <p className={`text-[10px] leading-relaxed font-sans ${socraticMode ? 'text-indigo-800' : 'text-stone-400'}`}>
                                        Teaches by asking questions.
                                    </p>
                                </div>

                                {/* "Life Application" Toggle */}
                                <div 
                                    onClick={() => { setPracticalMode(!practicalMode); setSocraticMode(false); }}
                                    className={`mb-8 p-4 border rounded-xl shadow-sm transition-all hover:shadow-md cursor-pointer group ${practicalMode ? 'bg-emerald-50 border-emerald-200 ring-1 ring-emerald-200' : 'bg-white border-stone-100'}`}
                                >
                                    <div className="flex items-center justify-between mb-2">
                                        <div className="flex items-center gap-3">
                                            <div className={`p-2 rounded-full ${practicalMode ? 'bg-emerald-200 text-emerald-800' : 'bg-stone-100 text-stone-400 group-hover:text-emerald-500'}`}>
                                                <RefreshCw className="w-4 h-4" />
                                            </div>
                                            <span className={`text-xs font-bold uppercase tracking-wider font-sans ${practicalMode ? 'text-emerald-900' : 'text-stone-600'}`}>Life Apply</span>
                                        </div>
                                        
                                        <div className={`w-10 h-6 rounded-full relative transition-colors duration-300 ${practicalMode ? 'bg-emerald-500' : 'bg-stone-200'}`}>
                                            <div className={`absolute top-1 w-4 h-4 bg-white rounded-full shadow-sm transition-transform duration-300 ${practicalMode ? 'left-5' : 'left-1'}`}></div>
                                        </div>
                                    </div>
                                    <p className={`text-[10px] leading-relaxed font-sans ${practicalMode ? 'text-emerald-800' : 'text-stone-400'}`}>
                                        Focus on modern action.
                                    </p>
                                </div>

                                <div className="mt-auto">
                                    <div className="p-6 bg-[#2C1810] text-stone-300 rounded-xl shadow-lg relative overflow-hidden">
                                        <div className="absolute top-0 right-0 p-4 opacity-10"><BookOpen className="w-20 h-20" /></div>
                                        <span className="block text-amber-500 font-bold text-[10px] uppercase tracking-widest mb-3 font-sans">Verse of the Day</span>
                                        <p className="font-cormorant italic text-lg leading-relaxed mb-3 text-amber-50">"Your word is a lamp to my feet and a light to my path."</p>
                                        <span className="block text-right text-xs text-stone-500 font-sans">- Psalm 119:105</span>
                                    </div>
                                </div>
                            </div>

                            {/* Main Chat */}
                            <div className="flex-1 flex flex-col relative z-10 bg-transparent">
                                <div className="flex-1 overflow-y-auto p-6 md:p-12 space-y-8 no-scrollbar" ref={scrollRef}>
                                    
                                    {/* Empty State / Welcome Screen */}
                                    {messages.length === 1 && !isLoading ? (
                                        <div className="h-full flex flex-col items-center justify-center animate-fade-in">
                                            <div className="w-20 h-20 bg-white rounded-full flex items-center justify-center mb-6 shadow-sm border border-stone-100">
                                                <Sparkles className="w-8 h-8 text-amber-600" />
                                            </div>
                                            <h2 className="font-cinzel text-3xl text-[#2C1810] mb-2">The Scholar</h2>
                                            <p className="font-cormorant text-xl text-stone-500 italic mb-12 text-center max-w-md">
                                                "I am here to guide you through history, scripture, and law. Where shall we begin?"
                                            </p>
                                            
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 w-full max-w-2xl">
                                                {quickTopics.map((topic, i) => (
                                                    <button
                                                        key={i}
                                                        onClick={() => { setInput(topic.text); handleSend(topic.text); }}
                                                        className="flex items-center gap-4 p-5 bg-white border border-stone-200 rounded-xl hover:border-amber-300 hover:shadow-md transition-all text-left group"
                                                    >
                                                        <div className="w-10 h-10 rounded-full bg-stone-50 flex items-center justify-center text-stone-400 group-hover:bg-amber-50 group-hover:text-amber-600 transition-colors">
                                                            <topic.icon className="w-5 h-5" />
                                                        </div>
                                                        <span className="font-cormorant text-lg text-stone-700 group-hover:text-stone-900 italic">"{topic.text}"</span>
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                    ) : (
                                        // Chat History
                                        messages.map((msg, idx) => (
                                            <div key={idx} className={`flex gap-4 ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                                {msg.role === 'assistant' && (
                                                    <div className="w-10 h-10 rounded-full bg-[#2C1810] flex items-center justify-center text-amber-500 shrink-0 mt-2 shadow-sm">
                                                        <Sparkles className="w-5 h-5" />
                                                    </div>
                                                )}
                                                
                                                <div className={`max-w-2xl p-6 md:p-8 rounded-2xl text-lg font-cormorant leading-relaxed shadow-sm ${
                                                    msg.role === 'user' 
                                                    ? 'bg-white border border-stone-200 text-stone-800 rounded-tr-none' 
                                                    : 'bg-[#FDFBF7] border border-stone-100 text-stone-900 rounded-tl-none shadow-sm'
                                                }`}>
                                                    {msg.text}
                                                </div>

                                                {msg.role === 'user' && (
                                                    <div className="w-10 h-10 rounded-full bg-stone-200 flex items-center justify-center text-stone-500 shrink-0 mt-2">
                                                        <div className="font-cinzel font-bold text-xs">YOU</div>
                                                    </div>
                                                )}
                                            </div>
                                        ))
                                    )}

                                    {/* Thinking Indicator */}
                                    {isLoading && (
                                        <div className="flex gap-4 justify-start animate-fade-in">
                                            <div className="w-10 h-10 rounded-full bg-[#2C1810] flex items-center justify-center text-amber-500 shrink-0 mt-2">
                                                <Sparkles className="w-5 h-5" />
                                            </div>
                                            <div className="bg-[#F5F5F0] p-6 rounded-2xl rounded-tl-none flex items-center gap-2">
                                                <div className="w-2 h-2 bg-stone-400 rounded-full animate-bounce"></div>
                                                <div className="w-2 h-2 bg-stone-400 rounded-full animate-bounce delay-75"></div>
                                                <div className="w-2 h-2 bg-stone-400 rounded-full animate-bounce delay-150"></div>
                                            </div>
                                        </div>
                                    )}
                                </div>

                                {/* Suggestion Pop-up */}
                                {suggestedResource && (
                                    <div className="absolute bottom-32 right-6 md:right-12 z-30 animate-slide-up">
                                        <div className="bg-white border border-stone-100 shadow-2xl rounded-xl p-6 max-w-sm flex items-start gap-5">
                                            <div className="bg-stone-50 p-3 rounded-full shrink-0">
                                                <suggestedResource.icon className="w-8 h-8 text-stone-400" />
                                            </div>
                                            <div>
                                                <div className="flex justify-between items-start mb-2">
                                                    <h4 className="font-bold text-stone-900 text-sm font-sans uppercase tracking-wider">Related Resource</h4>
                                                    <button onClick={() => setSuggestedResource(null)}><X className="w-4 h-4 text-stone-300 hover:text-stone-500" /></button>
                                                </div>
                                                <p className="text-sm font-cormorant text-stone-500 mb-3 leading-relaxed italic">
                                                    You mentioned <strong>{suggestedResource.category}</strong>. This might help:
                                                </p>
                                                <button 
                                                    onClick={() => addToCart(suggestedResource)} 
                                                    className="w-full py-2 bg-amber-50 text-amber-800 text-xs font-bold uppercase tracking-widest rounded-lg hover:bg-amber-100 transition-colors"
                                                >
                                                    View {suggestedResource.name}
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* INPUT AREA */}
                                <div className="p-6 md:p-8 bg-transparent">
                                    <div className="max-w-4xl mx-auto relative flex items-center gap-4 bg-white p-2 rounded-full shadow-xl border border-stone-200">
                                        <button
                                            onClick={startListening}
                                            className="p-4 bg-stone-50 text-stone-400 rounded-full hover:bg-stone-100 transition-colors"
                                        >
                                            <Mic className="w-5 h-5" />
                                        </button>

                                        <input
                                            type="text"
                                            value={input}
                                            onChange={(e) => setInput(e.target.value)}
                                            onKeyDown={(e) => e.key === 'Enter' && handleSend()}
                                            placeholder="Ask a question..."
                                            className="flex-1 bg-transparent border-none focus:ring-0 text-xl font-cormorant italic placeholder:text-stone-300 text-stone-800 outline-none px-2"
                                        />
                                        
                                        <button 
                                            onClick={() => handleSend()}
                                            disabled={isLoading}
                                            className="p-4 bg-[#2C1810] text-white rounded-full hover:bg-amber-800 transition-all hover:scale-105 shadow-md disabled:opacity-50 disabled:cursor-not-allowed"
                                        >
                                            <ArrowRight className="w-5 h-5" />
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </>
                    )}

                    {/* --- IMMERSIVE SANCTUARY MODE (VOICE) --- */}
                    {voiceMode && (
                        <div className="absolute inset-0 bg-[#1c1917] z-50 flex flex-col items-center justify-center text-white animate-fade-in overflow-hidden">
                            
                            {/* Exit Button */}
                            <div className="absolute top-0 w-full p-8 flex justify-between items-center z-20">
                                <div className="flex items-center gap-2">
                                    <div className="w-2 h-2 bg-red-500 rounded-full animate-pulse"></div>
                                    <span className="text-[10px] font-bold uppercase tracking-widest text-stone-500">Live Connection</span>
                                </div>
                                
                                {/* Toggle Switch (Active State) */}
                                <div className="flex items-center gap-4">
                                    <span className="text-[10px] font-bold uppercase tracking-widest text-stone-500">Return to Study</span>
                                    <button 
                                        onClick={() => { setVoiceMode(false); window.speechSynthesis.cancel(); }}
                                        className="w-10 h-6 bg-amber-700 rounded-full relative transition-colors duration-300"
                                    >
                                        <div className="absolute right-1 top-1 w-4 h-4 bg-white rounded-full shadow-sm transition-transform duration-300"></div>
                                    </button>
                                </div>
                            </div>

                            {/* Main Visual Content */}
                            <div className="max-w-4xl px-6 text-center relative z-20 flex flex-col items-center w-full">
                                
                                {/* THE AUDIO VISUALIZER */}
                                <div className="h-32 flex items-center justify-center gap-1 mb-12">
                                    {/* Generate bars for the wave */}
                                    {[...Array(12)].map((_, i) => (
                                        <div 
                                            key={i} 
                                            className={`w-2 rounded-full transition-all duration-300 ${
                                                isSpeaking 
                                                    ? 'bg-amber-400 animate-sound-wave' 
                                                    : isListening 
                                                        ? 'bg-red-500 h-12 animate-pulse' 
                                                        : 'bg-stone-800 h-3'
                                            }`}
                                            style={{ 
                                                animationDelay: `${i * 0.1}s`,
                                                height: isSpeaking ? undefined : (isListening ? '40px' : '6px') 
                                            }}
                                        ></div>
                                    ))}
                                </div>

                                {/* Current Message Display */}
                                <div className="min-h-[200px] flex items-center justify-center">
                                    <p className="font-cormorant text-3xl md:text-5xl leading-relaxed text-stone-200 animate-fade-in-up">
                                        {isListening ? (
                                            <span className="text-stone-500 italic">Listening...</span>
                                        ) : (
                                            `"${messages[messages.length - 1].text}"`
                                        )}
                                    </p>
                                </div>

                                {/* Interaction Button */}
                                <div className="mt-16">
                                    <button 
                                        onClick={startListening}
                                        className={`w-24 h-24 rounded-full flex items-center justify-center border transition-all duration-500 ${
                                            isListening 
                                            ? 'bg-red-500/20 border-red-500 text-red-500 animate-pulse scale-110' 
                                            : 'bg-stone-800/50 border-stone-700 text-stone-400 hover:border-amber-500 hover:text-amber-500 hover:scale-105'
                                        }`}
                                    >
                                        <Mic className="w-8 h-8" />
                                    </button>
                                    <p className="mt-6 text-[10px] font-bold uppercase tracking-widest text-stone-600">
                                        {isListening ? "Listening..." : "Tap to Speak"}
                                    </p>
                                </div>
                            </div>

                            {/* Background Atmosphere */}
                            <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-stone-800/20 via-[#1c1917] to-[#1c1917] pointer-events-none animate-pulse-glow"></div>
                        </div>
                    )}
                </div>
            );
        }

        function CartView({ cart, removeFromCart, setView }) {
            const total = cart.reduce((sum, item) => sum + item.price, 0);
            return (
                <div className="animate-fade-in pt-16 pb-12 px-6 min-h-screen">
                    <div className="max-w-4xl mx-auto">
                        <button onClick={() => setView('shop')} className="text-stone-400 hover:text-stone-900 font-bold text-sm flex items-center gap-2 mb-10 group uppercase tracking-widest text-xs">
                            <ArrowRight className="w-4 h-4 rotate-180 group-hover:-translate-x-1 transition-transform" /> Back to Bazaar
                        </button>
                        <h2 className="font-display font-black text-5xl mb-12 text-slate-900">Your Bundle</h2>
                        
                        <div className="bg-white rounded-[2.5rem] border border-stone-100 shadow-xl overflow-hidden">
                            {cart.length === 0 ? (
                                <div className="p-24 text-center">
                                    <ShoppingBag className="w-20 h-20 text-stone-200 mx-auto mb-6" />
                                    <p className="text-stone-500 text-xl font-medium">Your bundle is empty.</p>
                                    <button onClick={() => setView('shop')} className="mt-8 text-brand-primary font-bold hover:underline uppercase tracking-widest text-xs">Explore Gear</button>
                                </div>
                            ) : (
                                <div className="divide-y divide-stone-50">
                                    {cart.map((item, idx) => (
                                        <div key={idx} className="p-8 flex items-center gap-8">
                                            <div className={`w-24 h-24 ${item.color || 'bg-stone-100'} rounded-3xl flex items-center justify-center text-stone-500 shrink-0`}>
                                                <item.icon className="w-10 h-10" />
                                            </div>
                                            <div className="flex-1">
                                                <h4 className="font-display font-bold text-xl text-slate-900 mb-1">{item.name}</h4>
                                                <p className="text-stone-500 text-sm font-medium">{item.category}</p>
                                                {item.note && (
                                                    <span className="inline-block bg-amber-50 text-amber-700 text-[10px] uppercase font-bold tracking-wider px-3 py-1 rounded-full mt-3 border border-amber-100">Gift Message Included</span>
                                                )}
                                            </div>
                                            <div className="text-right">
                                                <div className="font-display font-bold text-xl text-slate-900 mb-2">{item.price === 0 ? "Free" : `$${item.price}`}</div>
                                                <button onClick={() => removeFromCart(idx)} className="text-xs text-red-400 font-bold hover:text-red-600 uppercase tracking-widest">Remove</button>
                                            </div>
                                        </div>
                                    ))}
                                    <div className="p-10 bg-stone-50 flex flex-col md:flex-row items-center justify-between gap-8">
                                        <div>
                                            <p className="text-stone-400 text-xs font-bold uppercase tracking-widest mb-1">Total</p>
                                            <p className="font-display font-black text-5xl text-brand-dark">${total.toFixed(2)}</p>
                                        </div>
                                        <button className="bg-brand-dark text-white font-bold py-5 px-16 rounded-2xl hover:bg-orange-500 transition-colors shadow-lg w-full md:w-auto uppercase tracking-widest text-xs">
                                            Checkout
                                        </button>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // --- MAIN APP ---

        function App() {
            const [view, setView] = useState('home'); 
            const [cart, setCart] = useState([]);
            const [isMenuOpen, setIsMenuOpen] = useState(false);
            const [toasts, setToasts] = useState([]);
            const [streak, setStreak] = useState(3);

            // Scroll to top when view changes
            useEffect(() => {
                window.scrollTo(0, 0);
            }, [view]);

            // Persistence
            useEffect(() => {
                const savedCart = localStorage.getItem('lumen_cart');
                if (savedCart) setCart(JSON.parse(savedCart));
                
                const savedStreak = localStorage.getItem('lumen_streak');
                if (savedStreak) setStreak(parseInt(savedStreak));
            }, []);

            useEffect(() => {
                localStorage.setItem('lumen_cart', JSON.stringify(cart));
            }, [cart]);
            
            useEffect(() => {
                localStorage.setItem('lumen_streak', streak.toString());
            }, [streak]);

            const showToast = (title, message) => {
                const id = Date.now();
                setToasts(prev => [...prev, { id, title, message }]);
                setTimeout(() => {
                    setToasts(prev => prev.filter(t => t.id !== id));
                }, 3000);
            };

            const removeToast = (id) => setToasts(prev => prev.filter(t => t.id !== id));
            const incrementStreak = () => setStreak(s => s + 1);

            const addToCart = (product, note = null) => {
                setCart([...cart, { ...product, note }]);
                showToast("Added to Bundle", `${product.name} is now in your cart.`);
            };
            
            const removeFromCart = (idx) => { 
                const n = [...cart]; 
                n.splice(idx,1); 
                setCart(n); 
            };

            const navItems = [
                { id: 'home', label: 'Hub' },
                { id: 'law', label: 'The Law' },
                { id: 'blog', label: 'Daily Scroll' },
                { id: 'ai', label: 'The Study' },
                { id: 'shop', label: 'Bazaar' },
            ];

            return (
                <div className="min-h-screen flex flex-col font-sans text-brand-dark bg-[#FDFBF7]">
                    <ToastContainer toasts={toasts} removeToast={removeToast} />
                    
                    {/* Modern Navbar */}
                    <nav className="fixed w-full z-50 bg-[#FDFBF7]/90 backdrop-blur-md border-b border-stone-200/60 transition-all duration-300">
                        <div className="max-w-7xl mx-auto px-6 h-24 flex justify-between items-center">
                            <div className="flex items-center gap-2 cursor-pointer" onClick={() => setView('home')}>
                                <span className="font-display font-black text-3xl tracking-tighter text-brand-dark">THE TEN.</span>
                            </div>

                            {/* Desktop Nav */}
                            <div className="hidden md:flex gap-2 bg-white/50 p-2 rounded-full border border-stone-200/50">
                                {navItems.map(item => (
                                    <button 
                                        key={item.id}
                                        onClick={() => setView(item.id)}
                                        className={`px-6 py-2.5 rounded-full text-xs font-bold uppercase tracking-wider transition-all ${
                                            view === item.id 
                                            ? 'bg-brand-dark text-white shadow-lg' 
                                            : 'text-stone-500 hover:text-brand-dark hover:bg-stone-100'
                                        }`}
                                    >
                                        {item.label}
                                    </button>
                                ))}
                            </div>

                            <div className="flex items-center gap-5">
                                <div className="hidden md:flex items-center gap-2 bg-orange-50 px-4 py-2 rounded-full border border-orange-100">
                                    <Flame className="w-4 h-4 text-orange-500 fill-orange-500 animate-pulse" />
                                    <span className="text-xs font-bold text-orange-800 uppercase tracking-wider">{streak} Day Streak</span>
                                </div>
                                <button onClick={() => setView('cart')} className="relative p-3 hover:bg-stone-100 rounded-full transition-colors group">
                                    <ShoppingBag className="w-5 h-5 text-stone-600 group-hover:text-brand-primary transition-colors" />
                                    {cart.length > 0 && <span className="absolute top-2 right-2 w-2.5 h-2.5 bg-brand-primary rounded-full border-2 border-white"></span>}
                                </button>
                                <button className="md:hidden p-2" onClick={() => setIsMenuOpen(!isMenuOpen)}>
                                    {isMenuOpen ? <X className="w-6 h-6" /> : <Menu className="w-6 h-6" />}
                                </button>
                            </div>
                        </div>
                        {isMenuOpen && (
                            <div className="md:hidden bg-white border-b border-stone-100 p-6 space-y-2 animate-fade-in absolute w-full shadow-2xl">
                                {navItems.map(item => (
                                    <button key={item.id} onClick={() => { setView(item.id); setIsMenuOpen(false); }} className="block w-full text-left p-4 rounded-2xl font-bold text-stone-600 hover:bg-stone-50 hover:text-brand-dark uppercase tracking-widest text-sm">{item.label}</button>
                                ))}
                            </div>
                        )}
                    </nav>

                    <main className="flex-grow pt-24">
                        {view === 'home' && <ModernHomeView setView={setView} incrementStreak={incrementStreak} streak={streak} />}
                        {view === 'law' && <LawView />}
                        {view === 'blog' && <BlogView />}
                        {view === 'shop' && <ResourcesView resources={RESOURCES} addToCart={addToCart} />}
                        {view === 'ai' && <StudyView resources={RESOURCES} addToCart={addToCart} user={auth?.currentUser} showToast={showToast} />}
                        {view === 'cart' && <CartView cart={cart} removeFromCart={removeFromCart} setView={setView} />}
                    </main>
                    <Footer view={view} />
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>